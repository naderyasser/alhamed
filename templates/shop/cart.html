{% extends "shop/base.html" %}
{% block content %}
<style>
  .hero-section { background: #0a0a0a !important; border-bottom: 1px solid #222; }
  .hero-section h1 { color: #fff !important; }
  .breadcrumbs a { color: #b0b0b0 !important; }
  .breadcrumbs span { color: #d32f2f !important; }
  .cart-item img { border-radius: 12px; background: radial-gradient(ellipse at 50% 30%, #1e1e1e, #0d0d0d); }
  .cart-table { background: #0a0a0a; border: 1px solid #222; border-radius: 18px; padding: 1.5rem; }
  .text-danger { color: #d32f2f !important; }
  .cart-total-box { background: #111 !important; border: 1px solid #222; border-radius: 18px; padding: 1.5rem; }
  .cart-total-box h4 { color: #fff !important; border-color: #222 !important; }
  .cart-total-box .table { color: #fff; }
  .cart-total-box .table th { color: #b0b0b0; }
  .cart-total-box .text-muted { color: #777 !important; }
  .cart-total-box .btn-outline-continue { border: 1px solid #333; color: #fff; background: transparent; }
  .cart-total-box .btn-outline-continue:hover { background: #222; }
  .cart-total-box .btn-checkout { background: #d32f2f; color: #fff; border: none; }
  .cart-total-box .btn-checkout:hover { background: #e53935; }
  .cart-item h6, .cart-item .fw-bold { color: #fff !important; }
  .last-orders-card { background: #111; border: 1px solid #222; border-radius: 18px; }
  .last-orders-card .card-title { color: #fff; }
  .last-orders-card .card-text { color: #b0b0b0 !important; }
  .last-orders-card .btn-primary { background: #d32f2f; border-color: #d32f2f; }
  .last-orders-card .btn-primary:hover { background: #e53935; }
  section h2 { color: #fff; }
</style>
<section class="hero-section d-flex align-items-center text-center">
      <div class="container">
            <h1 class="display-4">Cart</h1>
            <div class="breadcrumbs">
                  <a href="{{ url_for('shop.home') }}">Home</a> /
                  <a href="{{ url_for('shop.list') }}">Shop</a> /
                  <span>Cart</span>
            </div>
      </div>
</section>

<section class="py-5">
      <div class="container">
            <div class="row">
                  <div class="col-lg-8 col-md-12 mb-4">
                        <div class="cart-table">
                              {% if cart_items %}
                              <div class="cart-header d-none d-md-flex justify-content-between pb-3 text-muted">
                                    <span class="col-md-4">Product</span>
                                    <span class="col-md-4 text-center">Quantity</span>
                                    <span class="col-md-4 text-end">Subtotal</span>
                              </div>

                              {% for item in cart_items %}
                              <div class="cart-item border-top py-4" style="border-color: #222 !important;">
                                    <div class="row align-items-center">
                                          <div class="col-4 text-center">
                                                <img src="{{ item.product.image }}" class="img-fluid rounded"
                                                      style="max-width: 80px;">
                                          </div>
                                          <div class="col-8">
                                                <h6 class="mb-1">{{ item.product.name }}</h6>
                                                <span class="text-muted">{{ item.product.category.name }}</span>
                                                <div class="d-flex align-items-center mt-2">
                                                      <button class="btn btn-outline-secondary btn-sm"
                                                            onclick="location.href='{{ url_for('shop.change_quantity', action='minus', item_id=item.id) }}'">-</button>
                                                      <input type="number" class="form-control text-center mx-2"
                                                            style="max-width: 50px; background: #111; color: #fff; border-color: #333;" value="{{ item.quantity }}" min="1"
                                                            max="{{ item.product.stock }}" readonly>
                                                      <button class="btn btn-outline-secondary btn-sm"
                                                            onclick="location.href='{{ url_for('shop.change_quantity', action='plus', item_id=item.id) }}'">+</button>
                                                </div>
                                                <div class="fw-bold mt-2">{{ "%.2f"|format(item.product.price
                                                      * item.quantity) }} L.E</div>
                                                <a href="{{ url_for('shop.remove_from_cart', item_id=item.id) }}"
                                                      class="text-danger d-block mt-2">Remove</a>
                                          </div>
                                    </div>
                              </div>
                              {% endfor %}

                              {% else %}
                              <div class="text-center py-5">
                                    <i class="bi bi-cart-x display-1 text-muted"></i>
                                    <h3 class="my-4" style="color: #fff;">Your cart is empty</h3>
                                    <a href="{{ url_for('shop.list') }}" class="btn" style="background: #d32f2f; color: #fff;">Start Shopping</a>
                              </div>
                              {% endif %}
                        </div>
                  </div>

                  {% if cart_items %}
                  <div class="col-lg-4 col-md-12">
                        <div class="cart-total-box">
                              <h4 class="pb-3 border-bottom">Cart Total</h4>
                              <table class="table">
                                    <tr>
                                          <th>Subtotal</th>
                                          <td class="text-end fw-bold">{{ "%.2f"|format(total) }} L.E</td>
                                    </tr>
                                    <tr>
                                          <th>Shipping</th>
                                          <td class="text-end text-muted">Calculated at checkout</td>
                                    </tr>
                                    <tr class="border-top" style="border-color: #222 !important;">
                                          <th>Total</th>
                                          <td class="text-end fw-bold">{{ "%.2f"|format(total) }} L.E</td>
                                    </tr>
                              </table>
                              <a href="{{ url_for('shop.list') }}" class="btn btn-outline-continue w-100 mb-3">Continue
                                    Shopping</a>
                              <a href="{{ url_for('shop.checkout') }}" class="btn btn-checkout w-100">Proceed to
                                    Checkout</a>
                        </div>
                  </div>
                  {% endif %}
            </div>
      </div>
</section>
<!-- last_orders -->

<section class="py-5">
      <div class="container">
            <h2 class="text-center mb-4">Last Orders</h2>
            <div class="row">
                  {% for order in all_last_orders %}
                  <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card last-orders-card border-0">
                              <div class="card-body">
                                    <h5 class="card-title">Order #{{ order.id }}</h5>
                                    <p class="card-text">Total: {{ order.cod_amount }} L.E</p>
                                    <p class="card-text">Status: {{ order.status }}</p>
                                    <a href="{{ url_for('shop.order_detail', order_id=order.id) }}"
                                          class="btn btn-primary">View Order</a>
                              </div>
                        </div>
                  </div>
                  {% endfor %}
            </div>
      </div>
</section>

{% endblock %}